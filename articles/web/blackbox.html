<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="visreg">
<title>Forests, SVMs, etc. • visreg</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Forests, SVMs, etc.">
<meta property="og:description" content="visreg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">visreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.7.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-basic-framework">Basic framework</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-basic-framework">
    <a class="dropdown-item" href="../../articles/web/basic.html">Getting started</a>
    <a class="dropdown-item" href="../../articles/web/contrast.html">Contrast vs. conditional plots</a>
    <a class="dropdown-item" href="../../articles/web/trans.html">Transformations</a>
    <a class="dropdown-item" href="../../articles/web/cond.html">Conditioning</a>
    <a class="dropdown-item" href="../../articles/web/options.html">Graphical options</a>
    <a class="dropdown-item" href="../../articles/web/gg.html">Visreg and ggplot2</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-models-with-interactions">Models with interactions</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-models-with-interactions">
    <a class="dropdown-item" href="../../articles/web/cross.html">Cross-sectional plots</a>
    <a class="dropdown-item" href="../../articles/web/overlay.html">Overlay plots</a>
    <a class="dropdown-item" href="../../articles/web/surface.html">Surface plots</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-special-topics">Special topics</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-special-topics">
    <a class="dropdown-item" href="../../articles/web/glm.html">GLMs</a>
    <a class="dropdown-item" href="../../articles/web/blackbox.html">Forests, SVMs, etc.</a>
    <a class="dropdown-item" href="../../articles/web/mixed.html">Mixed models</a>
    <a class="dropdown-item" href="../../articles/web/multi.html">Multiple outcomes</a>
    <a class="dropdown-item" href="../../articles/web/faq.html">FAQ</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pbreheny/visreg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Forests, SVMs, etc.</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/visreg/blob/HEAD/vignettes/web/blackbox.rmd" class="external-link"><code>vignettes/web/blackbox.rmd</code></a></small>
      <div class="d-none name"><code>blackbox.rmd</code></div>
    </div>

    
    
<p>As the name implies, <code>visreg</code> is primarily designed to visualize regression models. However, it is also compatible with any formula-based model class that supplies a <code>predict</code> method, which includes models such as random forests and support vector machines. Such methods are often thought of as `<code>black boxes'', but</code>visreg` offers a convenient way to visualize the resulting fit and possibly gain some insight into the model. Some of these packages do not automatically handle missing data, so we first create a complete-case data set:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">aq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="random-forests">Random forests<a class="anchor" aria-label="anchor" href="#random-forests"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/" class="external-link">randomForest</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">aq</span><span class="op">)</span>
<span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Temp"</span>, ylab<span class="op">=</span><span class="st">"Ozone"</span><span class="op">)</span></code></pre></div>
<p><img src="blackbox_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="support-vector-machines">Support vector machines<a class="anchor" aria-label="anchor" href="#support-vector-machines"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">e1071</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/e1071/man/svm.html" class="external-link">svm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">aq</span><span class="op">)</span>
<span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Temp"</span>, ylab<span class="op">=</span><span class="st">"Ozone"</span><span class="op">)</span></code></pre></div>
<p><img src="blackbox_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>Note that neither random forests nor support vector machines are able to provide confidence bands for fitted values, so no shaded bands appear.</p>
</div>
<div class="section level2">
<h2 id="gradient-boosted-trees">Gradient boosted trees<a class="anchor" aria-label="anchor" href="#gradient-boosted-trees"></a>
</h2>
<p>The implementation of gradient boosted trees in the <code>gbm</code> package does not offer a <code>residuals</code> method. This would normally cause <code>visreg</code> to omit plotting the partial residuals. However, we can supply our own user-defined <code>residuals</code> method:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">residuals.gbm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">{</span><span class="va">fit</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fit</span><span class="op">}</span></code></pre></div>
<p>This is useful to be aware of in general: if you are ever working with a model class that does not provide a <code>residuals</code> method or a <code>predict</code> method, you can always write your own.</p>
<p>Once defined, we</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gbm-developers/gbm" class="external-link">gbm</a></span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">aq</span>, distribution<span class="op">=</span><span class="st">"gaussian"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Temp"</span>, ylab<span class="op">=</span><span class="st">"Ozone"</span><span class="op">)</span></code></pre></div>
<p><img src="blackbox_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<p>Note that the default settings for <code>gbm</code> do not produce a very good fit here. In particular, the default number of trees (100) is too low to capture the relationship between temperature and ozone. By increasing the number of trees, we obtain a much more reasonable fit:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">aq</span>, distribution<span class="op">=</span><span class="st">"gaussian"</span>, n.trees<span class="op">=</span><span class="fl">5000</span><span class="op">)</span>
<span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Temp"</span>, ylab<span class="op">=</span><span class="st">"Ozone"</span><span class="op">)</span></code></pre></div>
<p><img src="blackbox_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>This is a nice illustration of how visualizing a “black box” method using <code>visreg</code> can provide insight into setting some of the tuning parameters of these methods.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://myweb.uiowa.edu/pbreheny/" class="external-link">Patrick Breheny</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Last updated 2022-05-11</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
