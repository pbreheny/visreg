<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Transformations â€¢ visreg</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><link href="../../extra.css" rel="stylesheet">
<script src="../../extra.js"></script><meta property="og:title" content="Transformations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">visreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.7.0.15</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-basic-framework" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Basic framework</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-basic-framework">
<li><a class="dropdown-item" href="../../articles/web/basic.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../../articles/web/contrast.html">Contrast vs. conditional plots</a></li>
    <li><a class="dropdown-item" href="../../articles/web/trans.html">Transformations</a></li>
    <li><a class="dropdown-item" href="../../articles/web/cond.html">Conditioning</a></li>
    <li><a class="dropdown-item" href="../../articles/web/options.html">Graphical options</a></li>
    <li><a class="dropdown-item" href="../../articles/web/gg.html">Visreg and ggplot2</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-with-interactions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models with interactions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-with-interactions">
<li><a class="dropdown-item" href="../../articles/web/cross.html">Cross-sectional plots</a></li>
    <li><a class="dropdown-item" href="../../articles/web/overlay.html">Overlay plots</a></li>
    <li><a class="dropdown-item" href="../../articles/web/surface.html">Surface plots</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-special-topics" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Special topics</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-special-topics">
<li><a class="dropdown-item" href="../../articles/web/glm.html">GLMs</a></li>
    <li><a class="dropdown-item" href="../../articles/web/blackbox.html">Forests, SVMs, etc.</a></li>
    <li><a class="dropdown-item" href="../../articles/web/mixed.html">Mixed models</a></li>
    <li><a class="dropdown-item" href="../../articles/web/multi.html">Multiple outcomes</a></li>
    <li><a class="dropdown-item" href="../../articles/web/faq.html">FAQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Functions</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/visreg"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Transformations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/visreg/blob/master/vignettes/web/trans.rmd" class="external-link"><code>vignettes/web/trans.rmd</code></a></small>
      <div class="d-none name"><code>trans.rmd</code></div>
    </div>

    
    
<p><a href="basic.html">Getting started</a> described how
<code>visreg</code> provides a visual summary of a model, somewhat akin
to the numerical summary you get from <code>summary(fit)</code>. For
nonlinear terms, however, it is usually difficult to interpret numerical
summaries, and visual representations become far more important.</p>
<div class="section level2">
<h2 id="nonlinear-terms">Nonlinear terms<a class="anchor" aria-label="anchor" href="#nonlinear-terms"></a>
</h2>
<p>For example, suppose we allow the effect of wind on ozone to be
nonlinear by introducing a quadratic term into the model:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Wind</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Wind"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trans_files/figure-html/unnamed-chunk-2-1.png" width="480"></p>
<p>Note that <code>visreg</code> automatically detects the nonlinear
relationship and represents this correctly in the plot. This should work
for any transformation you can think of; here are some examples:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Wind</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Wind</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Wind"</span>, print.cond<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="trans_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">Wind</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Wind"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trans_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">Wind</span>, df<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Wind"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trans_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>If you ever run across a kind of transformation that produces an
error in <code>visreg</code>, <a href="https://github.com/pbreheny/visreg/issues" class="external-link">please tell us about
it</a> and we will fix it ASAP.</p>
</div>
<div class="section level2">
<h2 id="transformations-of-the-outcome">Transformations of the outcome<a class="anchor" aria-label="anchor" href="#transformations-of-the-outcome"></a>
</h2>
<p>Another kind of nonlinear model arises when the outcome is
transformed, but we are interested in plotting the relationship on the
original scale. For example, ozone levels must be positive. However, as
the <a href="index.html#gam">GAM on the front page</a> illustrates, some
models may result in predictions or confidence band that fall below 0.
One way of remedying this is to model the log of ozone concentrations
instead of the ozone concentrations directly:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Wind"</span>, trans<span class="op">=</span><span class="va">exp</span>, ylab<span class="op">=</span><span class="st">"Ozone"</span>, partial<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="trans_files/figure-html/unnamed-chunk-6-1.png" width="480"></p>
<p>Note that here, the plotting involves an inverse transformation.
There is no automatic way for <code>visreg</code> to know what the
correct inverse transformation is (except for <a href="glm.html">GLMs</a>), so this must be supplied as a function.</p>
<p>Also note that by default, <code>visreg</code> turns off partial
residuals when <code>trans</code> is specified, as this can provide a
distorted view of outliers (a mild outlier can become an extreme outlier
once a transformation has been applied, and vice versa), but we include
them here by explicitly specifying <code>partial=TRUE</code>. This is
discussed in greater depth in the page on <a href="glm.html#scale">GLMs</a>.</p>
</div>
<div class="section level2">
<h2 id="combining-nonlinear-terms-with-transformations">Combining nonlinear terms with transformations<a class="anchor" aria-label="anchor" href="#combining-nonlinear-terms-with-transformations"></a>
</h2>
<p>As one would hope, nonlinear terms and outcome transformations can be
combined and visualized in a straightforward manner:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Ozone</span><span class="op">)</span> <span class="op">~</span> <span class="va">Solar.R</span> <span class="op">+</span> <span class="va">Wind</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">Wind</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">Temp</span>, data<span class="op">=</span><span class="va">airquality</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Wind"</span>, trans<span class="op">=</span><span class="va">exp</span>, ylab<span class="op">=</span><span class="st">"Ozone"</span>, partial<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="trans_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://myweb.uiowa.edu/pbreheny/" class="external-link">Patrick Breheny</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last updated 2025-02-27</p>
</div>

    </footer>
</div>





  </body>
</html>
