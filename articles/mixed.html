<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mixed models • visreg</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Mixed models">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">visreg</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.7.0.16</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-basic-framework" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Basic framework</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-basic-framework">
<li><a class="dropdown-item" href="../articles/basic.html">Getting started</a></li>
    <li><a class="dropdown-item" href="../articles/contrast.html">Contrast vs. conditional plots</a></li>
    <li><a class="dropdown-item" href="../articles/trans.html">Transformations</a></li>
    <li><a class="dropdown-item" href="../articles/cond.html">Conditioning</a></li>
    <li><a class="dropdown-item" href="../articles/options.html">Graphical options</a></li>
    <li><a class="dropdown-item" href="../articles/gg.html">Visreg and ggplot2</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-with-interactions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models with interactions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-with-interactions">
<li><a class="dropdown-item" href="../articles/cross.html">Cross-sectional plots</a></li>
    <li><a class="dropdown-item" href="../articles/overlay.html">Overlay plots</a></li>
    <li><a class="dropdown-item" href="../articles/surface.html">Surface plots</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-models-with-interactions" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Models with interactions</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-models-with-interactions">
<li><a class="dropdown-item" href="../articles/glm.html">GLMs</a></li>
    <li><a class="dropdown-item" href="../articles/blackbox.html">Forests, SVMs, etc.</a></li>
    <li><a class="dropdown-item" href="../articles/mixed.html">Mixed models</a></li>
    <li><a class="dropdown-item" href="../articles/multi.html">Multiple outcomes</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">FAQ</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pbreheny/visreg/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mixed models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pbreheny/visreg/blob/master/vignettes/articles/mixed.rmd" class="external-link"><code>vignettes/articles/mixed.rmd</code></a></small>
      <div class="d-none name"><code>mixed.rmd</code></div>
    </div>

    
    
<p><code>visreg</code> can be used with mixed models, for example from
the <code>nlme</code> or <code>lme4</code> packages, although it is
worth noting that these packages are unable to incorporate uncertainty
about random effects into predictions, and therefore do not offer
confidence intervals, meaning that <code>visreg</code> plots will lack
confidence bands. Nevertheless, <code>visreg</code> is still useful for
visualizing the effects of fixed effects in such models using contrast
plots, as well as plotting effects without confidence intervals.</p>
<p>As an illustration, consider the following random-intercept,
random-slope model from a study involving the protein content of cows’
milk in the weeks following calving:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Milk</span>, package<span class="op">=</span><span class="st">"nlme"</span><span class="op">)</span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html" class="external-link">lmerControl</a></span><span class="op">(</span>optCtrl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>xtol_rel<span class="op">=</span><span class="fl">1e-6</span><span class="op">)</span><span class="op">)</span> <span class="co"># Warning otherwise</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">protein</span> <span class="op">~</span> <span class="va">Diet</span> <span class="op">+</span> <span class="va">Time</span> <span class="op">+</span> <span class="op">(</span><span class="va">Time</span><span class="op">|</span><span class="va">Cow</span><span class="op">)</span>, <span class="va">Milk</span>, control<span class="op">=</span><span class="va">ctrl</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="plotting-fixed-effects">Plotting fixed effects<a class="anchor" aria-label="anchor" href="#plotting-fixed-effects"></a>
</h2>
<p>As mentioned above, a conditional plot will lack confidence bands
(due to the large number of points, we’re making the partial residuals
smaller and partially transparent):</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Diet"</span>, ylab<span class="op">=</span><span class="st">"Protein"</span>, points<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"#55555540"</span>, cex<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mixed_files/figure-html/unnamed-chunk-3-1.png" width="480"></p>
<p>But, because the random effect terms drop out of a contrast plot, we
do have bands here:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Diet"</span>, type<span class="op">=</span><span class="st">"contrast"</span>, ylab<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">Delta</span><span class="op">*</span><span class="st">'Protein'</span><span class="op">)</span>, </span>
<span>       points<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"#55555540"</span>, cex<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mixed_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
</div>
<div class="section level2">
<h2 id="plotting-random-effects">Plotting random effects<a class="anchor" aria-label="anchor" href="#plotting-random-effects"></a>
</h2>
<p>The <code>visreg</code> package can also be used to plot random
effects, although again, the plots will not include intervals. Below, we
plot the modeled relationship between protein content and time for each
cow. Two aspects of the code are worth pointing out:</p>
<ul>
<li>According to the object-oriented design of <code>visreg</code>, the
<code>predict</code> method supplied by <code>lme4</code> is used. It
has its own option, <code>re.form</code>, to control how random effects
are used in the prediction, and this must be passed through
<code>visreg</code> accordingly.</li>
<li>For the sake of space, I’m going to subset the plot to ten cows
rather than all 79. This can be accomplished by returning, then
subsetting, the raw <code>visreg</code> object prior to plotting.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/visreg.html">visreg</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"Time"</span>, by<span class="op">=</span><span class="st">"Cow"</span>, re.form<span class="op">=</span><span class="op">~</span><span class="op">(</span><span class="va">Time</span><span class="op">|</span><span class="va">Cow</span><span class="op">)</span>, plot<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">subCow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">Milk</span><span class="op">$</span><span class="va">Cow</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">vv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">v</span>, <span class="va">Cow</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">subCow</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">vv</span>, ylab<span class="op">=</span><span class="st">"Protein"</span>, layout<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="mixed_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<p>Returning the data frames, estimates, confidence intervals, and
residuals used in the construction of its plots like this allows users
to write their own extensions and modifications of <code>visreg</code>
plots.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://myweb.uiowa.edu/pbreheny/" class="external-link">Patrick Breheny</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Last updated: July 27, 2025</p>
</div>

    </footer>
</div>





  </body>
</html>
